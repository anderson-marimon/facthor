<section class="w-full h-full flex flex-col !font-light">
    <main class="flex-1 h-full flex flex-col justify-center">
        <negotiation-parameters-table-filters
			[roleExecution]="_roleExecution()?.id || 0"
            [isLoadingApiGetNegotiationParameters]="_isLoadingApiGetNegotiationParameters()"
            [filterFunction]="_getNegotiationParametersForFilter.bind(this)"
            class="w-full flex justify-end gap-2.5 p-2.5"
        />

        <hr />

        <article class="flex-1 flex flex-col p-2.5">
            @if (_isLoadingApiGetNegotiationParameters()) {
                <general-loader [message]="'Cargando operaciones activas...'" />
            } @else {
                <div class="w-full h-[calc(100dvh-198px)] overflow-auto">
                    @if(_negotiationParameters()?.data?.length) {

                        <inherit-table class="flex-1 min-w-[960px] h-full animate-opacity-in">
                            @for (header of _headers; track $index; let first = $first) {
								<th class="w-72 [&_i-lucide_svg]:size-3.5 [&_i-lucide]:cursor-help">
									<span [ngClass]="{ 'pl-2.5': first }" class="text-start flex items-center gap-2.5">
										{{ header }}

										@switch ($index) {
											@case(2) {
												<i-lucide
													title="Plazo mínimo de financiamiento ofrecido por el financiador"
													[img]="_circleAlertIcon"
													[strokeWidth]="1.5"
												/>
											}
											@case(3) {
												<i-lucide
													title="Plazo máximo de financiamiento ofrecido por el financiador"
													[img]="_circleAlertIcon"
													[strokeWidth]="1.5"
												/>
											}
										}
									</span>
								</th>
							}
    
                            @for (column of _negotiationParameters()?.data; track $index) {
                                <tr>
									@if (this._roleExecution()?.id === _eRoleExecution.FINANCIER) {
										<td class="pl-2.5">{{ column.providerName }}</td>

										<td>{{ column?.interestPercentage?.toFixed(2) || 0 }}%</td>

										<td>{{ column.minDaysFinancing || 0}} días</td>

										<td>{{ column.maxDaysFinancing || 0}} días</td>

										<td>{{ column?.monthlyInterestRate?.toFixed(2) || 0 }}%</td>

										<td>
											<negotiation-parameter-status
												[status]="column.state"
												[statusName]="column.state ? 'Activo' : 'Inactivo'"
											/>
										</td>

										<td>{{ column.amountAsigned || 0 | currency }}</td>

										<td>{{ column.amountBalance || 0 | currency }}</td>

										<td>{{ column.date.split('T')[0] }}</td>
									} @else {
										<td class="pl-2.5">{{ column.financierName }}</td>

										<td>{{ column?.interestPercentage?.toFixed(2) || 0 }}%</td>

										<td>{{ column.minDaysFinancing || 0}} días</td>

										<td>{{ column.maxDaysFinancing || 0}} días</td>

										<td>{{ column?.monthlyInterestRate?.toFixed(2) || 0 }}%</td>

										<td>{{ column.amountAsigned || 0 | currency }}</td>

										<td>{{ column.amountBalance || 0 | currency }}</td>
									}

                                </tr>
                            }
                        </inherit-table>
                    } @else {
                       <empty-result />
                    }
                </div>
            }
        </article>
    </main>

    <hr />

    <inherit-table-footer
        [totalPages]="_negotiationParameters()?.countPages || 0"
        [currentPage]="_getNegotiationParameters().Page || 1"
        [paginatorFunction]="_getNegotiationParametersForPaginator.bind(this)"
        class="h-14 flex items-center justify-end gap-2.5 !text-[0.80rem] p-2.5 animate-opacity-in"
    />
</section>
