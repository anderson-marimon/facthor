<section class="w-full h-full flex flex-col !font-light overflow-hidden">
	<main class="relative flex-1 h-full flex flex-col justify-center">
		<financing-request-table-filters
			[roleExecution]="_roleExecution()?.id || 0"
			[isLoadingApiGetFinancingRequests]="_isLoadingApiGetFinancingRequests()"
			[filterFunction]="_getFinancierOperationsHistoryForFilter.bind(this)"
			class="w-full flex justify-end gap-2.5 p-2.5"
		/>

		<hr />

		<article class="flex-1 flex flex-col p-2.5">
			@if (_isLoadingApiGetFinancingRequests()) {
				<general-loader [message]="'Cargando solicitudes...'" />
			} @else {
				<div class="w-full h-[calc(100dvh-198px)] overflow-auto">
					@if(_financingRequests()?.data?.length) {

						<inherit-table class="min-w-[960px] h-full flex-1 animate-opacity-in">
							@for (header of _headers; track $index; let first = $first) {
								<th class="w-72">
                                    <span [ngClass]="{ 'pl-2.5': first }" class="block text-start">
										{{ header }}
                                    </span>
								</th>
							}

							@for (column of _financingRequests()?.data; track column.idProvider; let index = $index) {
								<tr>
									<td class="pl-2.5">
										<frs-checkbox
											[control]="_selectControls()[index]"
											[label]="column.providerBusinessLegalName"
											(change)="_onChangeSelectSingleRequest(index, column)"
											[class]="'!text-xs'"
										/>
									</td>

									<td>{{ column.providerIdetificationType }}</td>

									<td>
										<span class="block w-24">
											{{ column.providerIdentificationNumber }}
										</span>
									</td>

									<td [title]="column.providerTradename">
										<span class="block w-40 line-clamp-1 overflow-hidden truncate">
											{{ column.providerTradename }}
										</span>
									</td>

									<td [title]="column.providerEmail">
										<span class="block w-60 line-clamp-1 overflow-hidden truncate">
											{{ column.providerEmail }}
										</span>
									</td>


									<td [title]="column.providerLegalRepName">
										<span class="block w-24 line-clamp-1 overflow-hidden truncate">
											{{ column.isAccepted || 'No aceptado' }}
										</span>
									</td>

									<td [title]="column.providerLegalRepName">
										<span class="block w-40 line-clamp-1 overflow-hidden truncate">
											{{ column.providerLegalRepName }}
										</span>
									</td>

									<td>
										<span class="block w-24">
											{{ column.requestDate.split('T')[0] }}
										</span>
									</td>

									<td>
										<a
											frs-button
											[title]="`Ver documentos del proveedor: ${column.providerTradename}`"
											[variant]="'link'"
											[routerLink]="['/dashboard/parameters-management/negotiation/solicitude/documents']"
											[queryParams]="{ provider: column.idProvider, session: _sessionKey() }"
											[class]="'px-0 justify-start text-xs uppercase'"
										>
											ver documentos
										</a>
									</td>
								</tr>
							}
						</inherit-table>
					} @else {
						<empty-result [message]="'No se encontraron solicitudes'" />
					}
				</div>
			}
		</article>
		@if (_showPrepareParametersSection()) {
			<financing-requests-assign-parameters-drawer
				[@slideEffect]
				[minDaysFinancing]="_minDaysFinancing"
				[maxDaysFinancing]="_maxDaysFinancing"
				[amountAssigned]="_amountAssigned"
				[amountAssignedMonthUpdate]="_amountAssignedMonthUpdate"
				[operationPercentage]="_operationPercentage"
				[interestPercentage]="_interestPercentage"
				class="absolute top-0 left-0 z-10 w-full h-full flex flex-col xl:flex-row gap-2.5 p-2.5 bg-background overflow-y-auto"
			/>
		}
	</main>

	<hr class="relative z-20" />

	<inherit-table-footer
		[totalPages]="_financingRequests()?.countPages || 0"
		[currentPage]="_getFinancingRequestsParams().Page || 1"
		[paginatorFunction]="_getFinancierOperationsHistoryForPaginator.bind(this)"
		class="relative z-20 h-14 flex items-center justify-end gap-2.5 !text-[0.80rem] p-2.5 animate-opacity-in bg-background"
	>
		<section class="flex-1 flex gap-2.5">
			<button
				frs-button
				[variant]="'secondary'"
				[disabled]="!_selectedRequestsId().length ||  _isLoadingApiPostApproveFinancingRequest() || _isLoadingApiPostRejectFinancingRequest()"
				(click)="_onClickToggleShowAssignParameters()"
				class="w-40"
			>
				@if (_showPrepareParametersSection()) {
					Volver al listado
				} @else {
					Asignar par√°metros
				}
			</button>

			<button
				frs-button
				class="w-40"
				[disabled]="!_selectedRequestsId().length ||  _isLoadingApiPostApproveFinancingRequest() || _isLoadingApiPostRejectFinancingRequest() || _parametersForms.invalid"
				(click)="_onClickApproveFinancingRequest()"
			>
				@if (_isLoadingApiPostApproveFinancingRequest()) {
					<loading-icon [color]="'#FFFFFF'" class="size-6" />
				} @else {
					Aprobar proveedor
				}
			</button>

			<button
				frs-button
				class="w-40"
				[variant]="'destructive'"
				[disabled]="!_selectedRequestsId().length || _isLoadingApiPostApproveFinancingRequest() || _isLoadingApiPostRejectFinancingRequest()"
				(click)="_onClickRejectFinancingRequest()"
			>
				@if (_isLoadingApiPostRejectFinancingRequest()) {
					<loading-icon [color]="'#FFFFFF'" class="size-6" />
				} @else {
					Rechazar proveedor
				}
			</button>
		</section>
	</inherit-table-footer>
</section>
